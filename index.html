<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Mapa Tur√≠stico</title>

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />

  <style>
    html, body {
      height: 100%;
      margin: 0;
    }
    #map {
      width: 100%;
      height: 100%;
    }
  </style>
</head>

<body>

<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
  // Crear mapa
  var map = L.map('map').setView([-18.4783, -70.3211], 13);

  // Capa OpenStreetMap
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19
  }).addTo(map);

  // Variables globales JS
  var routeLine = null;
  var markers = [];

  // Evento clic en el mapa
  map.on('click', function(e) {
    var lat = e.latlng.lat;
    var lon = e.latlng.lng;

    // Enviar datos a App Inventor
    window.AppInventor.setWebViewString(
      "POINT:" + lat + ":" + lon
    );
  });

  // Agregar marcador
  function addMarker(lat, lon) {
    var marker = L.marker([lat, lon]).addTo(map);
    markers.push(marker);
  }

  // Dibujar ruta
  function drawRoute(latitudes, longitudes) {
    var points = [];

    for (var i = 0; i < latitudes.length; i++) {
      points.push([latitudes[i], longitudes[i]]);
    }

    if (routeLine !== null) {
      map.removeLayer(routeLine);
    }

    routeLine = L.polyline(points, { weight: 4 }).addTo(map);
    map.fitBounds(routeLine.getBounds());
  }

  // Limpiar mapa (opcional)
  function clearMap() {
    if (routeLine !== null) {
      map.removeLayer(routeLine);
      routeLine = null;
    }

    for (var i = 0; i < markers.length; i++) {
      map.removeLayer(markers[i]);
    }

    markers = [];
  }
</script>

</body>
</html>
